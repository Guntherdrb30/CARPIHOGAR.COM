generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Branch {
  id               String     @id @default(cuid())
  name             String
  code             String     @unique
  state            String
  city             String
  address          String
  lat              Decimal?   @db.Decimal(10, 7)
  lng              Decimal?   @db.Decimal(10, 7)
  motoRatePerKmUSD Decimal?   @db.Decimal(10, 4)
  carRatePerKmUSD  Decimal?   @db.Decimal(10, 4)
  vanRatePerKmUSD  Decimal?   @db.Decimal(10, 4)
  motoMinFeeUSD    Decimal?   @db.Decimal(10, 2)
  vanMinFeeUSD     Decimal?   @db.Decimal(10, 2)
  isActive         Boolean    @default(true)
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @default(now()) @updatedAt
  shippings        Shipping[]
  users            User[]
}

model User {
  id                              String                  @id @default(cuid())
  email                           String                  @unique
  password                        String
  name                            String?
  phone                           String?
  role                            Role                    @default(CLIENTE)
  alliedStatus                    AlliedStatus            @default(NONE)
  createdAt                       DateTime                @default(now())
  commissionPercent               Decimal?                @db.Decimal(5, 2)
  passwordResetToken              String?                 @unique
  passwordResetTokenExpiresAt     DateTime?
  profileImageUrl                 String?
  bio                             String?
  services                        String[]
  portfolioUrls                   String[]
  portfolioText                   String?
  deliveryStatus                  DeliveryStatus          @default(NONE)
  deliveryCedula                  String?
  deliveryAddress                 String?
  deliveryMotoPlate               String?
  deliveryChassisSerial           String?
  deliveryIdImageUrl              String?
  deliverySelfieUrl               String?
  deliveryAgreementAcceptedAt     DateTime?
  deliveryAgreementVersion        Int?
  deliveryAgreementIp             String?
  emailVerifiedAt                 DateTime?               @db.Timestamp(6)
  emailVerificationToken          String?
  emailVerificationTokenExpiresAt DateTime?               @db.Timestamp(6)
  deliveryVehicleBrand            String?
  deliveryVehicleModel            String?
  deliveryVehicleType             String?
  deliverySignedContractUrl       String?
  payoutBankName                  String?
  payoutBankAccount               String?
  payoutBankIdNumber              String?
  payoutPmBank                    String?
  payoutPmPhone                   String?
  payoutPmIdNumber                String?
  branchId                        String?
  addresses                       Address[]
  adminSettingsAuditLogs          AdminSettingsAuditLog[]
  allyProjects                    AllyProject[]           @relation("UserAllyProjects")
  assistantCarts                  AssistantCart[]
  commissions                     Commission[]
  commissionPaymentsCreated       CommissionPayment[]     @relation("CommissionPaymentCreatedBy")
  commissionPayments              CommissionPayment[]     @relation("CommissionPaymentSeller")
  assignedConversations           Conversation[]          @relation("ConversationAssignedTo")
  conversations                   Conversation[]          @relation("ConversationUser")
  designProjectsAssigned          DesignProject[]         @relation("DesignProjectArchitect")
  designProjectsCreated           DesignProject[]         @relation("DesignProjectCreatedBy")
  designPaymentsCreated           DesignProjectPayment[]  @relation("DesignProjectPaymentCreatedBy")
  designRendersCreated            DesignProjectRender[]   @relation("DesignProjectRenderCreatedBy")
  designTasksAssigned             DesignProjectTask[]     @relation("DesignTaskAssignee")
  designTasksCreated              DesignProjectTask[]     @relation("DesignTaskCreatedBy")
  designUpdatesCreated            DesignProjectUpdate[]   @relation("DesignProjectUpdateAuthor")
  driverLocations                 DriverLocation[]
  ecpdDesigns                     EcpdDesign[]
  kitchenDesigns                  KitchenDesign[]
  moodboards                      Moodboard[]
  news                            News[]                  @relation("UserNews")
  reviewedOrders                  Order[]                 @relation("OrderReviewedBy")
  sellerOrders                    Order[]                 @relation("OrderSeller")
  orders                          Order[]                 @relation("OrderCustomer")
  createdPurchases                Purchase[]              @relation("PurchaseCreatedBy")
  createdPOs                      PurchaseOrder[]         @relation("POCreator")
  receivedPOs                     PurchaseOrder[]         @relation("POReceiver")
  quotesAsSeller                  Quote[]                 @relation("QuoteSeller")
  quotes                          Quote[]                 @relation("QuoteCustomer")
  saleHoldsCreated                SaleHold[]              @relation("SaleHoldCreatedBy")
  deliveriesAssigned              Shipping[]              @relation("DeliveryAssignee")
  branch                          Branch?                 @relation(fields: [branchId], references: [id], onUpdate: NoAction, map: "User_branch_fkey")
  wishlistItems                   WishlistItem[]
}

model DesignProject {
  id                  String                 @id @default(cuid())
  name                String
  clientName          String
  location            String
  architectId         String?
  priority            Int                    @default(5)
  startDate           DateTime?
  dueDate             DateTime?
  status              DesignProjectStatus    @default(NUEVO)
  description         String?
  createdById         String?
  createdAt           DateTime               @default(now())
  updatedAt           DateTime               @default(now()) @updatedAt
  stage               DesignProjectStage     @default(BRIEFING)
  designTotalUSD      Decimal?               @db.Decimal(12, 2)
  initialMeasurements String?
  referenceImages     String[]               @default([])
  architect           User?                  @relation("DesignProjectArchitect", fields: [architectId], references: [id])
  createdBy           User?                  @relation("DesignProjectCreatedBy", fields: [createdById], references: [id])
  payments            DesignProjectPayment[]
  renders             DesignProjectRender[]
  tasks               DesignProjectTask[]
  updates             DesignProjectUpdate[]

  @@index([architectId, status])
  @@index([status, dueDate])
}

model DesignProjectTask {
  id           String           @id @default(cuid())
  projectId    String
  title        String
  assignedToId String?
  dueDate      DateTime?
  priority     Int              @default(5)
  status       DesignTaskStatus @default(PENDIENTE)
  comments     String?
  createdById  String?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @default(now()) @updatedAt
  assignedTo   User?            @relation("DesignTaskAssignee", fields: [assignedToId], references: [id])
  createdBy    User?            @relation("DesignTaskCreatedBy", fields: [createdById], references: [id])
  project      DesignProject    @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, status])
  @@index([assignedToId, dueDate])
}

model DesignProjectUpdate {
  id          String        @id @default(cuid())
  projectId   String
  note        String?
  fileUrl     String?
  createdById String?
  createdAt   DateTime      @default(now())
  createdBy   User?         @relation("DesignProjectUpdateAuthor", fields: [createdById], references: [id])
  project     DesignProject @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, createdAt])
}

model DesignProjectPayment {
  id          String         @id @default(cuid())
  projectId   String
  amountUSD   Decimal        @db.Decimal(12, 2)
  paidAt      DateTime
  method      PaymentMethod?
  reference   String?
  fileUrl     String?
  createdById String?
  createdAt   DateTime       @default(now())
  createdBy   User?          @relation("DesignProjectPaymentCreatedBy", fields: [createdById], references: [id])
  project     DesignProject  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, paidAt])
}

model DesignProjectRender {
  id             String        @id @default(cuid())
  projectId      String
  prompt         String
  sourceImageUrl String
  outputImageUrl String
  createdById    String?
  createdAt      DateTime      @default(now())
  createdBy      User?         @relation("DesignProjectRenderCreatedBy", fields: [createdById], references: [id])
  project        DesignProject @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, createdAt])
}

model SiteSettings {
  id                               Int       @id @default(1)
  brandName                        String    @default("Carpihogar.ai")
  whatsappPhone                    String
  contactPhone                     String
  contactEmail                     String
  ivaPercent                       Decimal   @default(16) @db.Decimal(5, 2)
  tasaVES                          Decimal   @default(40) @db.Decimal(10, 2)
  logoUrl                          String?
  primaryColor                     String?
  secondaryColor                   String?
  lowStockThreshold                Int       @default(5)
  sellerCommissionPercent          Decimal   @default(5) @db.Decimal(5, 2)
  deleteSecret                     String?
  homeHeroUrls                     String[]
  rootPhone                        String?
  rootRecoveryHash                 String?
  rootResetCode                    String?
  rootResetCodeExpiresAt           DateTime?
  defaultMarginClientPct           Decimal?  @db.Decimal(5, 2)
  defaultMarginAllyPct             Decimal?  @db.Decimal(5, 2)
  defaultMarginWholesalePct        Decimal?  @db.Decimal(5, 2)
  paymentZelleEmail                String?
  paymentPmPhone                   String?
  paymentPmRif                     String?
  paymentPmBank                    String?
  paymentBanescoAccount            String?
  paymentBanescoRif                String?
  paymentBanescoName               String?
  paymentMercantilAccount          String?
  paymentMercantilRif              String?
  paymentMercantilName             String?
  legalCompanyName                 String?
  legalCompanyRif                  String?
  legalCompanyAddress              String?
  legalCompanyPhone                String?
  invoiceNextNumber                Int?      @default(1)
  receiptNextNumber                Int?      @default(1)
  heroAutoplayMs                   Int?
  instagramHandle                  String?
  tiktokHandle                     String?
  categoryBannerCarpinteriaUrl     String?
  categoryBannerHogarUrl           String?
  supportHours                     String?
  ecpdHeroUrls                     String[]
  ecpdColors                       Json?
  moodboardHeroUrls                String[]
  deliveryMotoRatePerKmUSD         Decimal?  @db.Decimal(10, 4)
  deliveryCarRatePerKmUSD          Decimal?  @db.Decimal(10, 4)
  deliveryVanRatePerKmUSD          Decimal?  @db.Decimal(10, 4)
  deliveryMotoMinFeeUSD            Decimal?  @db.Decimal(10, 2)
  deliveryVanMinFeeUSD             Decimal?  @db.Decimal(10, 2)
  deliveryDriverSharePct           Decimal?  @db.Decimal(5, 2)
  deliveryCompanySharePct          Decimal?  @db.Decimal(5, 2)
  globalPriceAdjustmentPercent     Decimal?  @default(0) @db.Decimal(6, 2)
  globalPriceAdjustmentEnabled     Boolean   @default(false)
  priceAdjustmentUSDPercent        Decimal?  @default(0) @db.Decimal(6, 2)
  priceAdjustmentVESPercent        Decimal?  @default(0) @db.Decimal(6, 2)
  priceAdjustmentByCurrencyEnabled Boolean   @default(false)
  categoryPriceAdjustments         Json?
  usdPaymentDiscountPercent        Decimal?  @default(20) @db.Decimal(6, 2)
  usdPaymentDiscountEnabled        Boolean   @default(true)
  vesSalesDisabled                 Boolean   @default(false)
  slaWarningDays                   Decimal?  @default(7) @db.Decimal(6, 2)
  slaCriticalOverdueDays           Decimal?  @default(3) @db.Decimal(6, 2)
}

model Category {
  id          String     @id @default(cuid())
  name        String
  slug        String     @unique
  createdAt   DateTime   @default(now())
  parentId    String?
  description String?
  bannerUrl   String?
  parent      Category?  @relation("CategoryChildren", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryChildren")
  products    Product[]
}

model Product {
  id                         String              @id @default(cuid())
  name                       String
  slug                       String              @unique
  description                String?
  images                     String[]
  sku                        String?             @unique
  priceUSD                   Decimal             @db.Decimal(10, 2)
  priceAllyUSD               Decimal?            @db.Decimal(10, 2)
  stock                      Int                 @default(0)
  categoryId                 String?
  isNew                      Boolean             @default(false)
  createdAt                  DateTime            @default(now())
  brand                      String
  reorderPoint               Int?
  safetyStock                Int?
  leadTimeDays               Int?
  costMethod                 CostMethod          @default(PROMEDIO)
  avgCost                    Decimal?            @db.Decimal(10, 2)
  lastCost                   Decimal?            @db.Decimal(10, 2)
  supplierId                 String?
  barcode                    String?             @unique
  code                       String?             @unique
  priceWholesaleUSD          Decimal?            @db.Decimal(10, 2)
  costUSD                    Decimal?            @db.Decimal(10, 2)
  marginClientPct            Decimal?            @db.Decimal(5, 2)
  marginAllyPct              Decimal?            @db.Decimal(5, 2)
  marginWholesalePct         Decimal?            @db.Decimal(5, 2)
  priceClientUSD             Decimal?            @db.Decimal(10, 2)
  supplierCode               String?
  keywords                   String[]            @default([])
  model                      String?
  guarantee                  String?
  type                       ProductType         @default(SIMPLE)
  stockUnits                 Int                 @default(0)
  stockMinUnits              Int                 @default(0)
  allowBackorder             Boolean             @default(false)
  allowUnitSale              Boolean             @default(true)
  unitsPerPackage            Int?
  stockPackages              Int?
  soldBy                     ProductSoldBy       @default(UNIT)
  weightKg                   Decimal?            @db.Decimal(10, 3)
  heightCm                   Decimal?            @db.Decimal(10, 2)
  widthCm                    Decimal?            @db.Decimal(10, 2)
  depthCm                    Decimal?            @db.Decimal(10, 2)
  volumeCm3                  Decimal?            @db.Decimal(12, 2)
  freightType                String?
  status                     ProductStatus       @default(ACTIVE)
  videoUrl                   String?
  showSocialButtons          Boolean             @default(false)
  isConfigurable             Boolean             @default(false)
  configSchema               Json?
  deliveryAllowedVehicles    String[]            @default([])
  rootNoIvaOnly              Boolean             @default(false)
  isActive                   Boolean             @default(true)
  basePriceUsd               Decimal             @default(0) @db.Decimal(10, 2)
  productFamily              ProductFamily       @default(STANDARD)
  isParametric               Boolean             @default(false)
  widthMm                    Int?
  heightMm                   Int?
  depthMm                    Int?
  widthMinMm                 Int?
  widthMaxMm                 Int?
  heightMinMm                Int?
  heightMaxMm                Int?
  parametricPricingFormula   String?
  kitchenCategory            KitchenCategory?
  isVisibleInKitchenDesigner Boolean             @default(false)
  usableInQuickBudget        Boolean             @default(false)
  usableInKitchenDesigner    Boolean             @default(false)
  kitchenPriceLowUsd         Decimal?            @db.Decimal(10, 2)
  kitchenPriceMidUsd         Decimal?            @db.Decimal(10, 2)
  kitchenPriceHighUsd        Decimal?            @db.Decimal(10, 2)
  assistantCartItems         AssistantCartItem[]
  ecpdDesigns                EcpdDesign[]
  kitchenModules             KitchenModule[]
  orderItems                 OrderItem[]
  category                   Category?           @relation(fields: [categoryId], references: [id])
  supplier                   Supplier?           @relation(fields: [supplierId], references: [id])
  purchaseItems              PurchaseItem[]
  purchaseOrderItems         PurchaseOrderItem[]
  quoteItems                 QuoteItem[]
  relatedFrom                RelatedProduct[]    @relation("RelatedFrom")
  relatedTo                  RelatedProduct[]    @relation("RelatedTo")
  stockMoves                 StockMovement[]
  wishlistItems              WishlistItem[]
}

model RelatedProduct {
  fromId    String
  toId      String
  createdAt DateTime @default(now())
  from      Product  @relation("RelatedFrom", fields: [fromId], references: [id], onDelete: Cascade)
  to        Product  @relation("RelatedTo", fields: [toId], references: [id], onDelete: Cascade)

  @@id([fromId, toId])
}

model Address {
  id        String   @id @default(cuid())
  userId    String
  fullname  String
  phone     String
  state     String
  city      String
  zone      String?
  address1  String
  address2  String?
  notes     String?
  createdAt DateTime @default(now())
  lat       Decimal? @db.Decimal(10, 7)
  lng       Decimal? @db.Decimal(10, 7)
  user      User     @relation(fields: [userId], references: [id])
  orders    Order[]
}

model Order {
  id                    String             @id @default(cuid())
  userId                String
  subtotalUSD           Decimal            @db.Decimal(10, 2)
  ivaPercent            Decimal            @db.Decimal(5, 2)
  tasaVES               Decimal            @db.Decimal(10, 2)
  totalUSD              Decimal            @db.Decimal(10, 2)
  totalVES              Decimal            @db.Decimal(12, 2)
  createdAt             DateTime           @default(now())
  status                OrderStatus        @default(PENDIENTE)
  shippingAddressId     String?
  sellerId              String?
  customerTaxId         String?
  customerFiscalAddress String?
  saleType              SaleType           @default(CONTADO)
  creditDueDate         DateTime?
  originQuoteId         String?
  reviewedAt            DateTime?
  reviewedById          String?
  originChannel         String?            @default("ONLINE")
  invoiceNumber         Int?
  receiptNumber         Int?
  documentType          OrderDocumentType?
  commission            Commission?
  reviewedBy            User?              @relation("OrderReviewedBy", fields: [reviewedById], references: [id])
  seller                User?              @relation("OrderSeller", fields: [sellerId], references: [id])
  shippingAddress       Address?           @relation(fields: [shippingAddressId], references: [id])
  user                  User               @relation("OrderCustomer", fields: [userId], references: [id])
  authTokens            OrderAuthToken[]
  items                 OrderItem[]
  payment               Payment?
  receivable            Receivable?
  shipping              Shipping?

  @@index([originQuoteId])
  @@index([reviewedById])
}

model SaleHold {
  id                    String   @id @default(cuid())
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  createdById           String?
  sellerId              String?
  customerName          String?
  customerEmail         String?
  customerPhone         String?
  customerTaxId         String?
  customerFiscalAddress String?
  items                 Json
  meta                  Json?
  totalUSD              Decimal? @db.Decimal(12, 2)
  createdBy             User?    @relation("SaleHoldCreatedBy", fields: [createdById], references: [id])

  @@index([createdById])
  @@index([sellerId])
  @@index([createdAt])
}

model OrderItem {
  id                             String                          @id @default(cuid())
  orderId                        String
  productId                      String
  name                           String
  priceUSD                       Decimal                         @db.Decimal(10, 2)
  quantity                       Int
  CarpentryProjectInventoryEntry CarpentryProjectInventoryEntry?
  order                          Order                           @relation(fields: [orderId], references: [id])
  product                        Product                         @relation(fields: [productId], references: [id])
}

model Payment {
  id         String        @id @default(cuid())
  orderId    String        @unique
  method     PaymentMethod
  proofUrl   String?
  reference  String?
  status     PaymentStatus @default(SIN_PRUEBA)
  createdAt  DateTime      @default(now())
  currency   Currency      @default(USD)
  payerName  String?
  payerPhone String?
  payerBank  String?
  payerId    String?
  order      Order         @relation(fields: [orderId], references: [id])
}

model Commission {
  id        String           @id @default(cuid())
  orderId   String           @unique
  sellerId  String
  percent   Decimal          @db.Decimal(5, 2)
  amountUSD Decimal          @db.Decimal(10, 2)
  status    CommissionStatus @default(PENDIENTE)
  createdAt DateTime         @default(now())
  order     Order            @relation(fields: [orderId], references: [id])
  seller    User             @relation(fields: [sellerId], references: [id])
}

model CommissionPayment {
  id          String        @id @default(cuid())
  sellerId    String
  amount      Decimal       @db.Decimal(12, 2)
  currency    Currency      @default(USD)
  method      PaymentMethod
  reference   String?
  bankName    String?
  paidAt      DateTime
  paidByName  String?
  proofUrl    String?
  createdAt   DateTime      @default(now())
  createdById String?
  createdBy   User?         @relation("CommissionPaymentCreatedBy", fields: [createdById], references: [id])
  seller      User          @relation("CommissionPaymentSeller", fields: [sellerId], references: [id])

  @@index([sellerId, paidAt])
  @@index([reference])
}

model Quote {
  id                    String      @id @default(cuid())
  userId                String
  sellerId              String?
  subtotalUSD           Decimal     @db.Decimal(10, 2)
  ivaPercent            Decimal     @db.Decimal(5, 2)
  tasaVES               Decimal     @db.Decimal(10, 2)
  totalUSD              Decimal     @db.Decimal(10, 2)
  totalVES              Decimal     @db.Decimal(12, 2)
  status                QuoteStatus @default(BORRADOR)
  expiresAt             DateTime?
  notes                 String?
  customerTaxId         String?
  customerFiscalAddress String?
  createdAt             DateTime    @default(now())
  seller                User?       @relation("QuoteSeller", fields: [sellerId], references: [id])
  user                  User        @relation("QuoteCustomer", fields: [userId], references: [id])
  items                 QuoteItem[]
}

model QuoteItem {
  id        String  @id @default(cuid())
  quoteId   String
  productId String
  name      String
  priceUSD  Decimal @db.Decimal(10, 2)
  quantity  Int
  product   Product @relation(fields: [productId], references: [id])
  quote     Quote   @relation(fields: [quoteId], references: [id])
}

model StockMovement {
  id        String        @id @default(cuid())
  productId String
  type      StockMoveType
  quantity  Int
  reason    String?
  userId    String?
  createdAt DateTime      @default(now())
  product   Product       @relation(fields: [productId], references: [id])
}

model AuditLog {
  id        String   @id @default(cuid())
  userId    String?
  action    String
  details   String?
  createdAt DateTime @default(now())
  projectId String?

  @@index([projectId, createdAt])
}

model AdminSettingsAuditLog {
  id              String   @id @default(cuid())
  settingKey      String
  oldValue        String?
  newValue        String?
  changedByUserId String?
  changedAt       DateTime @default(now())
  ipAddress       String?
  userAgent       String?
  changedBy       User?    @relation(fields: [changedByUserId], references: [id])

  @@index([changedAt])
  @@index([settingKey])
}

model ShipmentPhoto {
  id         String   @id @default(cuid())
  shipmentId String
  type       String
  url        String
  createdAt  DateTime @default(now()) @db.Timestamptz(6)
  shipment   Shipping @relation(fields: [shipmentId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "ShipmentPhoto_shipment_fkey")

  @@index([shipmentId], map: "ShipmentPhoto_shipment_idx")
}

model DriverLocation {
  id        String   @id @default(cuid())
  driverId  String
  lat       Decimal  @db.Decimal(10, 7)
  lng       Decimal  @db.Decimal(10, 7)
  updatedAt DateTime @default(now()) @db.Timestamptz(6)
  driver    User     @relation(fields: [driverId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "DriverLocation_driver_fkey")

  @@index([driverId], map: "DriverLocation_driver_idx")
}

model Supplier {
  id             String          @id @default(cuid())
  name           String
  email          String?
  phone          String?
  taxId          String?
  address        String?
  createdAt      DateTime        @default(now())
  rifImageUrl    String?
  contactName    String?
  contactPhone   String?
  givesCredit    Boolean         @default(false)
  creditDays     Int?
  chargeCurrency Currency        @default(USD)
  Payable        Payable[]
  products       Product[]
  purchases      Purchase[]
  purchaseOrders PurchaseOrder[]
}

model PurchaseOrder {
  id           String              @id @default(cuid())
  supplierId   String
  status       POStatus            @default(DRAFT)
  expectedAt   DateTime?
  totalUSD     Decimal             @default(0) @db.Decimal(12, 2)
  notes        String?
  createdAt    DateTime            @default(now())
  createdById  String?
  receivedById String?
  receivedAt   DateTime?
  purchaseType PurchaseType        @default(CONTADO)
  createdBy    User?               @relation("POCreator", fields: [createdById], references: [id])
  receivedBy   User?               @relation("POReceiver", fields: [receivedById], references: [id])
  supplier     Supplier            @relation(fields: [supplierId], references: [id])
  items        PurchaseOrderItem[]
}

model PurchaseOrderItem {
  id        String        @id @default(cuid())
  poId      String
  productId String
  quantity  Int
  received  Int           @default(0)
  costUSD   Decimal       @db.Decimal(10, 2)
  po        PurchaseOrder @relation(fields: [poId], references: [id])
  product   Product       @relation(fields: [productId], references: [id])
}

model Purchase {
  id                String            @id @default(cuid())
  supplierId        String?
  currency          Currency          @default(USD)
  tasaVES           Decimal           @default(0) @db.Decimal(10, 2)
  subtotalUSD       Decimal           @default(0) @db.Decimal(12, 2)
  totalUSD          Decimal           @default(0) @db.Decimal(12, 2)
  notes             String?
  createdAt         DateTime?         @default(now()) @db.Timestamp(6)
  createdById       String?
  invoiceNumber     String?
  baseAmountUSD     Decimal?          @db.Decimal(12, 2)
  discountPercent   Decimal?          @db.Decimal(5, 2)
  discountAmountUSD Decimal?          @db.Decimal(12, 2)
  ivaPercent        Decimal?          @db.Decimal(5, 2)
  ivaAmountUSD      Decimal?          @db.Decimal(12, 2)
  itemsCount        Int?
  invoiceDate       DateTime?
  igtfPercent       Decimal?          @db.Decimal(5, 2)
  igtfAmountUSD     Decimal?          @db.Decimal(12, 2)
  invoiceImageUrl   String?
  bankTransactions  BankTransaction[]
  Payable           Payable?
  createdBy         User?             @relation("PurchaseCreatedBy", fields: [createdById], references: [id])
  supplier          Supplier?         @relation(fields: [supplierId], references: [id])
  items             PurchaseItem[]
}

model PurchaseItem {
  id          String   @id @default(cuid())
  purchaseId  String
  productId   String
  name        String
  quantity    Int
  costUSD     Decimal  @db.Decimal(10, 2)
  subtotalUSD Decimal  @db.Decimal(12, 2)
  product     Product  @relation(fields: [productId], references: [id])
  purchase    Purchase @relation(fields: [purchaseId], references: [id], onDelete: Cascade)
}

model BankAccount {
  id             String            @id @default(cuid())
  name           String
  bankName       String?
  accountNumber  String?
  currency       Currency          @default(USD)
  initialBalance Decimal           @default(0) @db.Decimal(14, 2)
  isActive       Boolean           @default(true)
  createdAt      DateTime          @default(now()) @db.Timestamptz(6)
  transactions   BankTransaction[]
  PayableEntry   PayableEntry[]
}

model BankTransaction {
  id            String              @id @default(cuid())
  bankAccountId String
  type          BankTransactionType
  amount        Decimal             @db.Decimal(14, 2)
  currency      Currency            @default(USD)
  description   String?
  reference     String?
  purchaseId    String?
  createdAt     DateTime            @default(now()) @db.Timestamptz(6)
  bankAccount   BankAccount         @relation(fields: [bankAccountId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  purchase      Purchase?           @relation(fields: [purchaseId], references: [id], onUpdate: NoAction)
}

model Payable {
  id         String         @id @default(cuid())
  purchaseId String         @unique
  supplierId String?
  status     PayableStatus  @default(PENDIENTE)
  totalUSD   Decimal        @db.Decimal(12, 2)
  balanceUSD Decimal        @db.Decimal(12, 2)
  dueDate    DateTime?      @db.Timestamptz(6)
  notes      String?
  createdAt  DateTime       @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime       @default(now()) @updatedAt @db.Timestamptz(6)
  Purchase   Purchase       @relation(fields: [purchaseId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  Supplier   Supplier?      @relation(fields: [supplierId], references: [id], onUpdate: NoAction)
  entries    PayableEntry[]
}

model PayableEntry {
  id            String         @id @default(cuid())
  payableId     String
  amountUSD     Decimal        @db.Decimal(12, 2)
  currency      Currency       @default(USD)
  method        PaymentMethod?
  bankAccountId String?
  reference     String?
  notes         String?
  createdAt     DateTime       @default(now()) @db.Timestamptz(6)
  BankAccount   BankAccount?   @relation(fields: [bankAccountId], references: [id], onUpdate: NoAction)
  payable       Payable        @relation(fields: [payableId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Shipping {
  id                  String          @id @default(cuid())
  orderId             String          @unique
  carrier             ShippingCarrier
  tracking            String?
  status              ShippingStatus  @default(PENDIENTE)
  observations        String?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  channel             ShippingChannel @default(TIENDA)
  assignedToId        String?
  assignedAt          DateTime?       @db.Timestamp(6)
  deliveryFeeUSD      Decimal?        @db.Decimal(10, 2)
  deliveryPaidAt      DateTime?
  clientConfirmedAt   DateTime?
  deliveryConfirmedAt DateTime?
  clientRating        Int?
  deliveryRating      Int?
  tipUSD              Decimal?        @db.Decimal(10, 2)
  branchId            String?
  photos              ShipmentPhoto[]
  assignedTo          User?           @relation("DeliveryAssignee", fields: [assignedToId], references: [id])
  branch              Branch?         @relation(fields: [branchId], references: [id], onUpdate: NoAction, map: "Shipping_branch_fkey")
  order               Order           @relation(fields: [orderId], references: [id])
}

model Receivable {
  id        String            @id @default(cuid())
  orderId   String            @unique
  status    ReceivableStatus  @default(PENDIENTE)
  dueDate   DateTime?
  notes     String?
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  order     Order             @relation(fields: [orderId], references: [id])
  entries   ReceivableEntry[]
  noteItems ReceivableNote[]
}

model ReceivableEntry {
  id           String         @id @default(cuid())
  receivableId String
  amountUSD    Decimal        @db.Decimal(12, 2)
  currency     Currency       @default(USD)
  method       PaymentMethod?
  reference    String?
  notes        String?
  createdAt    DateTime       @default(now())
  receivable   Receivable     @relation(fields: [receivableId], references: [id])
}

model ReceivableNote {
  id           String             @id @default(cuid())
  receivableId String
  type         ReceivableNoteType
  amountUSD    Decimal            @db.Decimal(12, 2)
  reason       String?
  createdAt    DateTime           @default(now())
  receivable   Receivable         @relation(fields: [receivableId], references: [id], onDelete: Cascade, map: "ReceivableNote_receivable_fkey")
}

model WishlistItem {
  id        String   @id @default(cuid())
  userId    String
  productId String
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
}

model Conversation {
  id             String              @id @default(cuid())
  userId         String?
  phone          String
  channel        Channel             @default(WHATSAPP)
  assignedToId   String?
  status         ConversationStatus? @default(OPEN)
  assignedAt     DateTime?           @db.Timestamp(6)
  closedAt       DateTime?           @db.Timestamp(6)
  lastInboundAt  DateTime?           @db.Timestamp(6)
  lastOutboundAt DateTime?           @db.Timestamp(6)
  unreadAgent    Int?                @default(0)
  unreadCustomer Int?                @default(0)
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  lastMessageAt  DateTime?
  assignedTo     User?               @relation("ConversationAssignedTo", fields: [assignedToId], references: [id])
  user           User?               @relation("ConversationUser", fields: [userId], references: [id])
  messages       Message[]

  @@index([userId])
  @@index([phone])
  @@index([lastMessageAt])
}

model Message {
  id             String           @id @default(cuid())
  conversationId String
  direction      MessageDirection
  status         MessageStatus    @default(SENT)
  type           String           @default("TEXT")
  text           String?
  mediaUrl       String?
  waMessageId    String?
  createdAt      DateTime         @default(now())
  conversation   Conversation     @relation(fields: [conversationId], references: [id])

  @@index([conversationId, createdAt])
}

model News {
  id        String   @id @default(cuid())
  authorId  String
  imageUrl  String
  title     String?
  excerpt   String?
  createdAt DateTime @default(now())
  author    User     @relation("UserNews", fields: [authorId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([createdAt])
  @@index([authorId, createdAt])
}

model Course {
  id           String       @id @default(cuid())
  slug         String       @unique
  title        String
  topic        String
  summary      String?
  curriculum   Json?
  priceUSD     Decimal      @db.Decimal(10, 2)
  status       CourseStatus @default(DRAFT)
  heroImageUrl String?
  videoUrl     String?
  saleStartAt  DateTime?    @db.Timestamp(6)
  saleEndAt    DateTime?    @db.Timestamp(6)
  createdAt    DateTime     @default(now()) @db.Timestamp(6)

  @@index([status, createdAt])
}

model AllyProject {
  id        String   @id @default(cuid())
  userId    String
  images    String[]
  videoUrl  String?
  caption   String?
  createdAt DateTime @default(now())
  user      User     @relation("UserAllyProjects", fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([userId, createdAt])
}

model AssistantCart {
  id        String              @id @default(cuid())
  ownerKey  String
  userId    String?
  createdAt DateTime            @default(now()) @db.Timestamptz(6)
  updatedAt DateTime            @default(now()) @db.Timestamptz(6)
  user      User?               @relation(fields: [userId], references: [id], onUpdate: NoAction, map: "AssistantCart_user_fkey")
  items     AssistantCartItem[]

  @@index([ownerKey])
}

model AssistantCartItem {
  id        String        @id @default(cuid())
  cartId    String
  productId String
  name      String
  priceUSD  Decimal       @db.Decimal(10, 2)
  quantity  Int
  createdAt DateTime      @default(now()) @db.Timestamptz(6)
  cart      AssistantCart @relation(fields: [cartId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "AssistantCartItem_cart_fkey")
  product   Product       @relation(fields: [productId], references: [id], onUpdate: NoAction, map: "AssistantCartItem_product_fkey")

  @@unique([cartId, productId], map: "AssistantCartItem_cart_product_unique")
}

model Moodboard {
  id        String   @id @default(cuid())
  userId    String
  title     String
  jsonData  Json
  thumbnail String?
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, updatedAt])
}

model EcpdDesign {
  id              String   @id @default(cuid())
  userId          String
  productId       String
  spaceImageUrl   String
  config          Json
  overlayX        Float    @default(0.5)
  overlayY        Float    @default(0.5)
  overlayScale    Float    @default(1)
  overlayRotation Float    @default(0)
  priceUSD        Decimal  @db.Decimal(10, 2)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @default(now()) @updatedAt
  product         Product  @relation(fields: [productId], references: [id])
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
}

model KitchenDesign {
  id             String              @id @default(cuid())
  userId         String
  name           String
  layoutType     KitchenLayoutType
  status         KitchenDesignStatus @default(DRAFT)
  totalPriceUsd  Decimal             @default(0) @db.Decimal(12, 2)
  planJson       Json?
  modulesJson    Json?
  budgetJson     Json?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @default(now()) @updatedAt
  user           User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  kitchenModules KitchenModule[]
  spaces         KitchenSpace[]

  @@index([userId, updatedAt])
  @@index([userId, status])
}

model KitchenSpace {
  id        String        @id @default(cuid())
  kitchenId String
  wallName  String
  widthMm   Int
  heightMm  Int?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @default(now()) @updatedAt
  kitchen   KitchenDesign @relation(fields: [kitchenId], references: [id], onDelete: Cascade)

  @@unique([kitchenId, wallName])
  @@index([kitchenId])
}

model KitchenModule {
  id                 String        @id @default(cuid())
  kitchenId          String
  productId          String
  positionX          Int
  positionY          Int
  widthMm            Int
  depthMm            Int
  lockedHeight       Int
  priceCalculatedUsd Decimal       @db.Decimal(12, 2)
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @default(now()) @updatedAt
  kitchen            KitchenDesign @relation(fields: [kitchenId], references: [id], onDelete: Cascade)
  product            Product       @relation(fields: [productId], references: [id])

  @@index([kitchenId])
  @@index([productId])
}

model PayrollEmployee {
  id                              String                              @id @default(cuid())
  name                            String
  role                            String?
  phone                           String?
  email                           String?
  type                            PayrollEmployeeType                 @default(FIJA)
  weeklySalaryUSD                 Decimal?                            @db.Decimal(10, 2)
  active                          Boolean                             @default(true)
  notes                           String?
  createdAt                       DateTime                            @default(now())
  updatedAt                       DateTime                            @default(now()) @updatedAt
  inventoryDeliveries             CarpentryProjectInventoryDelivery[] @relation("MaterialDeliveryReceiver")
  materialListDeliveries          CarpentryProjectMaterialList[]      @relation("MaterialListReceiver")
  carpentryTasks                  CarpentryTask[]
  payments                        PayrollPayment[]
  productionOrdersAsCarpentryLead ProductionOrder[]                   @relation("ProductionCarpenter")
  productionOrdersAsSupervisor    ProductionOrder[]                   @relation("ProductionSupervisor")
}

model PayrollPayment {
  id           String                 @id @default(cuid())
  employeeId   String?
  category     PayrollPaymentCategory @default(OTRO)
  amountUSD    Decimal                @db.Decimal(12, 2)
  paidAt       DateTime               @default(now())
  description  String?
  service      String?
  createdAt    DateTime               @default(now())
  projectId    String?
  projectPhase CarpentryProjectPhase?
  method       String?
  reference    String?
  employee     PayrollEmployee?       @relation(fields: [employeeId], references: [id], onUpdate: NoAction)
  project      CarpentryProject?      @relation(fields: [projectId], references: [id], onUpdate: NoAction)

  @@index([employeeId])
  @@index([category, paidAt])
  @@index([projectId])
}

model CarpentryProject {
  id                  String                              @id @default(cuid())
  name                String
  clientName          String?
  description         String?
  totalAmountUSD      Decimal                             @db.Decimal(12, 2)
  fabricationPct      Decimal                             @default(70) @db.Decimal(5, 2)
  installationPct     Decimal                             @default(30) @db.Decimal(5, 2)
  fabricationPaidUSD  Decimal                             @default(0) @db.Decimal(12, 2)
  installationPaidUSD Decimal                             @default(0) @db.Decimal(12, 2)
  status              CarpentryProjectStatus              @default(ACTIVO)
  startDate           DateTime?
  endDate             DateTime?
  createdAt           DateTime                            @default(now())
  updatedAt           DateTime                            @default(now()) @updatedAt
  clientEmail         String?
  clientPhone         String?
  clientAddress       String?
  clientCity          String?
  clientState         String?
  initialPaymentUSD   Decimal?                            @db.Decimal(12, 2)
  laborCostUSD        Decimal?                            @db.Decimal(12, 2)
  carpenterId         String?
  architectId         String?
  supervisorId        String?
  clientPayments      CarpentryClientPayment[]
  expenses            CarpentryProjectExpense[]
  files               CarpentryProjectFile[]
  inventoryDeliveries CarpentryProjectInventoryDelivery[]
  inventoryEntries    CarpentryProjectInventoryEntry[]
  materialLists       CarpentryProjectMaterialList[]
  purchaseOrders      CarpentryProjectPurchaseOrder[]
  tasks               CarpentryTask[]
  payments            PayrollPayment[]
  productionOrders    ProductionOrder[]

  @@index([architectId])
  @@index([carpenterId])
  @@index([supervisorId])
}

model CarpentryProjectFile {
  id          String                   @id @default(cuid())
  projectId   String
  url         String
  filename    String?
  fileType    CarpentryProjectFileType @default(OTRO)
  createdAt   DateTime                 @default(now())
  description String?
  project     CarpentryProject         @relation(fields: [projectId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([projectId])
}

model CarpentryProjectMaterialList {
  id            String                     @id @default(dbgenerated("gen_random_uuid()"))
  projectId     String
  name          String
  description   String?
  fileUrl       String
  uploadedAt    DateTime                   @default(now()) @db.Timestamptz(6)
  phase         CarpentryProjectPhase?
  deliveredAt   DateTime?
  deliveredById String?
  items         CarpentryProjectMaterial[]
  deliveredBy   PayrollEmployee?           @relation("MaterialListReceiver", fields: [deliveredById], references: [id], onUpdate: NoAction)
  project       CarpentryProject           @relation(fields: [projectId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([projectId])
  @@index([deliveredById], map: "CarpentryProjectMaterialList_deliveredById_index")
}

model CarpentryProjectMaterial {
  id           String                       @id @default(dbgenerated("gen_random_uuid()"))
  listId       String
  sku          String?
  name         String
  category     String?
  unit         String?
  quantity     Int                          @default(0)
  unitPriceUSD Decimal                      @db.Decimal(12, 2)
  list         CarpentryProjectMaterialList @relation(fields: [listId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([listId])
}

model CarpentryProjectPurchaseOrder {
  id                                String                              @id @default(dbgenerated("gen_random_uuid()"))
  projectId                         String
  saleId                            String?
  totalUSD                          Decimal                             @db.Decimal(12, 2)
  status                            ProjectPurchaseStatus               @default(PENDING)
  requiresSecret                    Boolean                             @default(false)
  secretToken                       String?
  notes                             String?
  createdAt                         DateTime                            @default(now()) @db.Timestamptz(6)
  CarpentryProjectInventoryDelivery CarpentryProjectInventoryDelivery[]
  CarpentryProjectInventoryEntry    CarpentryProjectInventoryEntry[]
  project                           CarpentryProject                    @relation(fields: [projectId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([projectId])
}

model CarpentryProjectInventoryEntry {
  id                String                                  @id @default(cuid())
  projectId         String
  purchaseOrderId   String
  orderId           String
  orderItemId       String                                  @unique
  itemName          String
  sku               String?
  productId         String?
  quantity          Int                                     @default(0)
  remainingQuantity Int                                     @default(0)
  unitPriceUSD      Decimal                                 @default(0) @db.Decimal(12, 2)
  createdAt         DateTime                                @default(now()) @db.Timestamptz(6)
  updatedAt         DateTime                                @default(now()) @updatedAt @db.Timestamptz(6)
  deliveryItems     CarpentryProjectInventoryDeliveryItem[]
  OrderItem         OrderItem                               @relation(fields: [orderItemId], references: [id], onUpdate: NoAction)
  project           CarpentryProject                        @relation(fields: [projectId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  purchaseOrder     CarpentryProjectPurchaseOrder           @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([projectId], map: "CarpentryProjectInventoryEntry_projectId_index")
  @@index([purchaseOrderId], map: "CarpentryProjectInventoryEntry_purchaseOrderId_index")
}

model CarpentryProjectInventoryDelivery {
  id              String                                  @id @default(cuid())
  projectId       String
  purchaseOrderId String
  phase           CarpentryProjectPhase?
  notes           String?
  deliveredAt     DateTime                                @default(now()) @db.Timestamptz(6)
  deliveredById   String?
  createdAt       DateTime                                @default(now()) @db.Timestamptz(6)
  deliveredBy     PayrollEmployee?                        @relation("MaterialDeliveryReceiver", fields: [deliveredById], references: [id], onUpdate: NoAction)
  project         CarpentryProject                        @relation(fields: [projectId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  purchaseOrder   CarpentryProjectPurchaseOrder           @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  items           CarpentryProjectInventoryDeliveryItem[]

  @@index([projectId], map: "CarpentryProjectInventoryDelivery_projectId_index")
  @@index([purchaseOrderId], map: "CarpentryProjectInventoryDelivery_purchaseOrderId_index")
}

model CarpentryProjectInventoryDeliveryItem {
  id         String                            @id @default(cuid())
  deliveryId String
  entryId    String
  quantity   Int
  createdAt  DateTime                          @default(now()) @db.Timestamptz(6)
  delivery   CarpentryProjectInventoryDelivery @relation(fields: [deliveryId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  entry      CarpentryProjectInventoryEntry    @relation(fields: [entryId], references: [id], onUpdate: NoAction)

  @@index([entryId], map: "CarpentryProjectInventoryDeliveryItem_entryId_index")
}

model CarpentryProjectExpense {
  id            String           @id @default(dbgenerated("gen_random_uuid()"))
  projectId     String
  provider      String
  invoiceNumber String?
  description   String
  expenseType   ExpenseType
  date          DateTime         @db.Timestamptz(6)
  quantity      Int              @default(1)
  unitCostUSD   Decimal          @db.Decimal(12, 2)
  totalCostUSD  Decimal          @db.Decimal(12, 2)
  receiptUrl    String?
  createdById   String?
  createdAt     DateTime         @default(now()) @db.Timestamptz(6)
  project       CarpentryProject @relation(fields: [projectId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([projectId])
}

model ProductionOrder {
  id              String           @id @default(dbgenerated("gen_random_uuid()"))
  projectId       String
  number          String           @unique
  carpentryLeadId String?
  supervisorId    String?
  phase           String?
  scheduledStart  DateTime?        @db.Timestamptz(6)
  scheduledEnd    DateTime?        @db.Timestamptz(6)
  installDate     DateTime?        @db.Timestamptz(6)
  status          ProductionStatus @default(PLANNED)
  progressPct     Decimal          @default(0) @db.Decimal(5, 2)
  notes           String?
  createdAt       DateTime         @default(now()) @db.Timestamptz(6)
  updatedAt       DateTime         @default(now()) @updatedAt @db.Timestamptz(6)
  tasks           CarpentryTask[]  @relation("ProductionTasks")
  carpentryLead   PayrollEmployee? @relation("ProductionCarpenter", fields: [carpentryLeadId], references: [id], onUpdate: NoAction)
  project         CarpentryProject @relation(fields: [projectId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  supervisor      PayrollEmployee? @relation("ProductionSupervisor", fields: [supervisorId], references: [id], onUpdate: NoAction)

  @@index([projectId])
}

model CarpentryTask {
  id                String                 @id @default(cuid())
  employeeId        String
  projectId         String?
  description       String
  workDate          DateTime               @default(now())
  amountUSD         Decimal                @db.Decimal(12, 2)
  phase             CarpentryProjectPhase?
  createdAt         DateTime               @default(now())
  status            String?                @default("PENDIENTE")
  productionOrderId String?
  employee          PayrollEmployee        @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  productionOrder   ProductionOrder?       @relation("ProductionTasks", fields: [productionOrderId], references: [id], onUpdate: NoAction)
  project           CarpentryProject?      @relation(fields: [projectId], references: [id], onUpdate: NoAction)

  @@index([employeeId])
  @@index([projectId])
  @@index([productionOrderId])
}

model CarpentryClientPayment {
  id        String           @id @default(dbgenerated("gen_random_uuid()"))
  projectId String
  amountUSD Decimal          @db.Decimal(12, 2)
  paidAt    DateTime         @default(now()) @db.Timestamptz(6)
  method    String?
  reference String?
  notes     String?
  proofUrl  String?
  createdAt DateTime         @default(now()) @db.Timestamptz(6)
  project   CarpentryProject @relation(fields: [projectId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_project")

  @@index([projectId])
  @@index([paidAt])
}

model OrderAuthToken {
  id          String    @id @default(cuid())
  orderId     String
  token       String
  expiresAt   DateTime  @db.Timestamptz(6)
  usedAt      DateTime? @db.Timestamptz(6)
  createdAt   DateTime  @default(now()) @db.Timestamptz(6)
  channel     String?
  destination String?
  order       Order     @relation(fields: [orderId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "OrderAuthToken_order_fkey")

  @@unique([orderId, token], map: "OrderAuthToken_order_token_unique")
}

model OrdersTemp {
  id           String   @id @default(dbgenerated("gen_random_uuid()"))
  customerId   String
  items        Json
  totalUSD     Decimal  @default(0) @db.Decimal(10, 2)
  shippingData Json?
  createdAt    DateTime @default(now()) @db.Timestamptz(6)
}

model PurchaseToken {
  id          String   @id @default(dbgenerated("gen_random_uuid()"))
  customerId  String
  orderTempId String
  token       String
  expiresAt   DateTime @db.Timestamptz(6)
  used        Boolean  @default(false)
  createdAt   DateTime @default(now()) @db.Timestamptz(6)

  @@index([customerId], map: "PurchaseToken_customer_idx")
  @@index([orderTempId, token], map: "PurchaseToken_temp_token_idx")
}

enum Role {
  CLIENTE
  ALIADO
  ADMIN
  VENDEDOR
  DELIVERY
  DESPACHO
  ARCHITECTO
  SUPERVISOR_PROYECTOS
}

enum DesignProjectStatus {
  NUEVO
  EN_PROGRESO
  EN_REVISION
  EN_PAUSA
  ENTREGADO
  CANCELADO
}

enum DesignProjectStage {
  BRIEFING
  PROPUESTA
  RENDERS
  REVISION
  AJUSTES
  ENTREGA
}

enum DesignTaskStatus {
  PENDIENTE
  EN_PROGRESO
  BLOQUEADA
  COMPLETADA
}

enum AlliedStatus {
  NONE
  PENDING
  APPROVED
}

enum DeliveryStatus {
  NONE
  PENDING
  APPROVED
}

enum ProductType {
  SIMPLE
  GROUPED
  COMBO
}

enum ProductSoldBy {
  UNIT
  PACKAGE
  BOTH
}

enum ProductStatus {
  ACTIVE
  INACTIVE
  REVIEW
  WHOLESALE_ONLY
  CLEARANCE
}

enum ProductFamily {
  STANDARD
  PARAMETRIC_FURNITURE
  KITCHEN_MODULE
}

enum KitchenCategory {
  LOW
  HIGH
  PANTRY
  TOWER
  OTHER
  FRIDGE
  CONDIMENT
}

enum KitchenLayoutType {
  LINEAL
  L_SHAPE
  DOUBLE_LINE
  LINEAL_WITH_ISLAND
  L_WITH_ISLAND
  L_WITH_PENINSULA
  CUSTOM_SPACE
}

enum KitchenDesignStatus {
  DRAFT
  SAVED
  ARCHIVED
}

enum OrderStatus {
  PENDIENTE
  CONFIRMACION
  PAGADO
  ENVIADO
  COMPLETADO
  CANCELADO
}

enum SaleType {
  CONTADO
  CREDITO
}

enum OrderDocumentType {
  RECIBO
  FACTURA
}

enum PaymentMethod {
  PAGO_MOVIL
  TRANSFERENCIA
  ZELLE
  EFECTIVO
}

enum PaymentStatus {
  SIN_PRUEBA
  EN_REVISION
  RECHAZADO
  APROBADO
}

enum Currency {
  USD
  VES
  USDT
}

enum CommissionStatus {
  PENDIENTE
  PAGADA
}

enum QuoteStatus {
  BORRADOR
  ENVIADO
  APROBADO
  RECHAZADO
  VENCIDO
}

enum StockMoveType {
  ENTRADA
  SALIDA
  AJUSTE
}

enum CostMethod {
  PROMEDIO
  FIFO
}

enum POStatus {
  DRAFT
  ORDERED
  RECEIVED
  CANCELLED
}

enum PurchaseType {
  CONTADO
  PARCIAL
  CREDITO
}

enum BankTransactionType {
  DEBITO
  CREDITO
}

enum PayableStatus {
  PENDIENTE
  PARCIAL
  PAGADO
  CANCELADO
}

enum ShippingCarrier {
  TEALCA
  MRW
  OTRO
  FLETE_PRIVADO
  RETIRO_TIENDA
  DELIVERY
}

enum ShippingStatus {
  PENDIENTE
  PREPARANDO
  DESPACHADO
  EN_TRANSITO
  ENTREGADO
  INCIDENCIA
}

enum ShippingChannel {
  ONLINE
  TIENDA
}

enum PayrollEmployeeType {
  FIJA
  CONTRATADA
}

enum PayrollPaymentCategory {
  NOMINA_FIJA
  NOMINA_CONTRATADA
  OTRO
  CARPINTERIA
}

enum CarpentryProjectStatus {
  ACTIVO
  EN_PROCESO
  CERRADO
}

enum CarpentryProjectFileType {
  PLANO
  IMAGEN
  OTRO
  PRESUPUESTO
  AVANCE
  SOPORTE
}

enum CarpentryProjectPhase {
  FABRICACION
  INSTALACION
  CORTE_CANTEADO
  ARMADO_ESTRUCTURA
  ARMADO_PUERTAS
  INSTALACION_HERRAJES
  EMBALAJE
  ALMACEN
}

enum CarpentryTaskStatus {
  PENDIENTE
  EN_PROGRESO
  COMPLETADA
}

enum ReceivableStatus {
  PENDIENTE
  PARCIAL
  PAGADO
  CANCELADO
}

enum ReceivableNoteType {
  CREDITO
  DEBITO
}

enum Channel {
  WHATSAPP
}

enum MessageDirection {
  IN
  OUT
}

enum MessageStatus {
  SENT
  DELIVERED
  READ
  FAILED
}

enum ConversationStatus {
  OPEN
  IN_PROGRESS
  PENDING
  RESOLVED
  CLOSED
}

enum CourseStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum ProjectPurchaseStatus {
  PENDING
  APPROVED
  DELIVERED
  CANCELLED
}

enum ExpenseType {
  FLETE
  EXTRA
  MATERIAL
  OTRO
}

enum ProductionStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  ON_HOLD
}
